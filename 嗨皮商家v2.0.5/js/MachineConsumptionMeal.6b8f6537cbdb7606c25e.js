(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["MachineConsumptionMeal"],{"097b":function(t,e,a){"use strict";var n=a("21f1"),i=a.n(n);i.a},"21f1":function(t,e,a){},"2a5f":function(t,e,a){"use strict";var n=a("5fe3"),i=a.n(n);i.a},"492f":function(t,e,a){"use strict";a("caad"),a("a9e3");var n,i,r=a("5530"),o=a("5cc0"),s=a("2f62"),c={name:"MyMachine",components:{LinkageSelection:o["a"]},model:{prop:"value",event:"trigger-change"},props:{storeId:[String,Number],areaId:[String,Number],value:{default:function(){return{}}},title:{type:String,default:"请选择机台"},type:{type:String,default:"MACHINE",validator:function(t){return["MACHINE","MACHINE_TYPE"].includes(t)}},rightIcon:{type:String,default:"arrow"},columns:Array},data:function(){return{list:[]}},watch:{areaId:{handler:function(t){var e=this.storeId,a=this.type;if(e&&t){var n={storeId:e,areaId:t};if("MACHINE_TYPE"===a)return void this.COMMON_GETMACHINETYPE_ACTION(n).then(this.handleReturnDeal);this.COMMON_GETMACHINE_ACTION(n).then(this.handleReturnDeal)}else this.list=[],this.$emit("trigger-change",{})},immediate:!0}},methods:Object(r["a"])(Object(r["a"])({},Object(s["b"])(["COMMON_GETMACHINE_ACTION","COMMON_GETMACHINETYPE_ACTION"])),{},{handleChoseMachine:function(t){this.$emit("trigger-change",t.value)},handleReturnDeal:function(t){if("0"===t.return_code){var e=t.data;this.list=e,this.$emit("trigger-change",{})}}}),render:function(){for(var t,e=arguments[0],a=this.value,n=this.list,i=this.handleChoseMachine,r=this.title,s=this.rightIcon,c=0,l=0;l<n.length;++l)if(n[l].id===a.id){t=n[l].no,c=l;break}return e(o["a"],{attrs:{"right-icon":s,title:r,value:t,columns:n,"default-index":c},on:{"trigger-confirm":i}})}},l=c,d=a("2877"),u=Object(d["a"])(l,n,i,!1,null,null,null),h=u.exports;e["a"]=h},"5cc0":function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",[a("CellList",{attrs:{title:t.title,value:t.value,"right-icon":t.rightIcon,placeholder:t.placeholder},on:{"trigger-click":function(e){t.show=!0}},scopedSlots:t._u([t.$slots.title?{key:"title",fn:function(){return[t._t("title")]},proxy:!0}:null,t.$slots["right-icon"]?{key:"right-icon",fn:function(){return[t._t("right-icon")]},proxy:!0}:null],null,!0)}),a("BottomPopup",{attrs:{columns:t.columns,"default-index":t.defaultIndex,show:t.show},on:{"trigger-confirm":t.handleConfirm,"trigger-close":function(e){t.show=!1}}})],1)},i=[],r=(a("a9e3"),a("a5ab")),o=a("5594"),s={name:"LinkageSelection",components:{CellList:r["a"],BottomPopup:o["a"]},model:{prop:"value",event:"trigger-confirm"},props:{value:{default:""},defaultIndex:Number,disabled:{type:Boolean,default:!1},title:String,placeholder:String,columns:Array,rightIcon:{type:String}},data:function(){return{show:!1}},computed:{},mounted:function(){},methods:{handleConfirm:function(t){this.disabled||this.$emit("trigger-confirm",t)}}},c=s,l=a("2877"),d=Object(l["a"])(c,n,i,!1,null,"673b6974",null),u=d.exports;e["a"]=u},"5fe3":function(t,e,a){},a5ab:function(t,e,a){"use strict";var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"cell-list flex-row flex-between-center padding-20-30",on:{click:t.handleClick}},[a("div",{staticClass:"cell-list-title size-28 color-3"},[t._v(" "+t._s(t.$slots["title"]?null:t.title)+" "),t._t("title")],2),a("div",{staticClass:"size-28 flex-row flex-start-center"},[t.value?a("span",[t._v(t._s(t.value))]):a("span",{staticClass:"cell-list-placeholder"},[t._v(t._s(t.placeholder))]),t.rightIcon?a("van-icon",{staticClass:"flex-row flex-center margin-left-10 size-32",attrs:{color:"#969799",name:t.rightIcon}}):t._e(),t._t("rigth-icon")],2)])},i=[],r={name:"CellList",components:{},props:{title:String,value:String,placeholder:String,leftIcon:{type:Boolean,default:!1},rightIcon:{type:String}},data:function(){return{}},computed:{},mounted:function(){},methods:{handleClick:function(t){this.$emit("trigger-click",t)}}},o=r,s=(a("097b"),a("2877")),c=Object(s["a"])(o,n,i,!1,null,null,null),l=c.exports;e["a"]=l},a640b:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"machine-consumption-meal"},[a("div",{staticClass:"header bgcolor-f"},[a("MyStore",{attrs:{"store-id":t.storeId,"default-index":0},on:{"trigger-click":t.handleConfirm}},[a("div",{staticClass:"flex-row flex-end-center flex-1"},[a("TipIcon")],1)]),a("div",{staticClass:"border"}),a("div",[a("h5",{staticClass:"margin-0 padding-20-30 size-30"},[t._v("我的机台")]),a("div",{staticClass:"border"}),a("MyArea",{attrs:{"store-id":t.storeId},model:{value:t.area,callback:function(e){t.area=e},expression:"area"}}),a("div",{staticClass:"border"}),a("MyMachine",{attrs:{"store-id":t.storeId,"area-id":t.area.id,value:t.machine},on:{"trigger-change":t.handleChangeMachine}})],1),a("div",{staticClass:"border"})],1),t.machine.id?a("div",{staticClass:"main flex-column flex-start-stretch"},[a("div",{staticClass:"container"},[a("div",{staticClass:"bgcolor-f size-28"},[a("div",{staticClass:"flex-row flex-between-center"},[a("h4",{staticClass:"padding-20-10 margin-0"},[t._v("活动时效")]),a("van-button",{attrs:{type:"info",size:"small"},on:{click:t.handleGoRouter}},[t._v("去配置新套餐")])],1),a("div",{staticClass:"padding-20-10"},[a("van-checkbox",{attrs:{name:"1",value:"1"===t.radio},on:{click:function(e){t.radio="1"}}},[t._v("立即生效，换货后失效")])],1),a("div",{staticClass:"border"}),a("div",{staticClass:"padding-20-10"},[a("van-checkbox",{attrs:{name:"2",value:"2"===t.radio},on:{click:function(e){t.radio="2"}}},[t._v("活动期")]),a("ul",{staticClass:"no-ul"},[a("li",[a("CellList",{attrs:{title:"开启",value:t.getDate(t.startDate),"right-icon":"arrow"},on:{"trigger-click":function(e){return t.handleOpenCouponDate("startDate")}}})],1),a("li",{staticClass:"border"}),a("li",[a("CellList",{attrs:{title:"结束",value:t.getDate(t.endDate),"right-icon":"arrow"},on:{"trigger-click":function(e){return t.handleOpenCouponDate("endDate")}}})],1)])],1)]),a("ul",{staticClass:"no-ul"},t._l(t.list,(function(e,n){return a("li",{key:n,staticClass:"padding-20-10"},[a("ConsumptionPackageItem",{attrs:{packageItem:e},on:{"trigger-checked":t.handleChecked}})],1)})),0)]),a("div",[a("HhfButton",{attrs:{size:"large",bottomZIndex:9,type:"info"},on:{"trigger-click":t.handleSave}},[t._v("保存")])],1)]):t._e(),a("van-popup",{attrs:{position:"bottom","get-container":"body",overlay:""},on:{"click-overlay":t.handleDateClose},model:{value:t.dateShow,callback:function(e){t.dateShow=e},expression:"dateShow"}},[a("van-datetime-picker",{attrs:{type:"datetime","min-date":t.minDate,"max-date":t.maxDate},on:{confirm:t.handleDateConfirm,cancel:t.handleDateCancel},model:{value:t.currentDate,callback:function(e){t.currentDate=e},expression:"currentDate"}})],1)],1)},i=[],r=(a("d81d"),a("b0c0"),a("d3b7"),a("25f0"),a("5530")),o=a("de0f"),s=a("a8aa"),c=a("f059"),l=a("492f"),d=a("c32d"),u=a.n(d),h=a("a5ab"),f=a("c85b"),m=a("5212"),g=a("365c"),p={name:"MachineConsumptionMeal",components:{MyStore:s["a"],MyArea:c["a"],MyMachine:l["a"],CellList:h["a"],ConsumptionPackageItem:m["a"],HhfButton:o["a"],TipIcon:f["a"]},data:function(){return{storeId:null,storeName:"",area:{},machine:{},list:[],radio:"",dateShow:!1,minDate:new Date,currentDateKey:"",currentDate:new Date,startDate:0,endDate:0,checkedPackage:{},maxDate:new Date(2025,10,1)}},created:function(){var t=this.$route.query,e=t.sid,a=t.mid,n=t.aid;e&&(this.storeId=e),e&&n&&(this.area.id=n),e&&n&&a&&(this.machine.id=a)},mounted:function(){},methods:{getDate:function(t){return t&&"0"!==t?u()(1e3*t).format("YYYY-MM-DD kk:mm:ss"):""},handleRouter:function(){this.$router.push({name:"Article"})},handleGoRouter:function(){this.$router.push({name:"ConsumptionPackage",query:{sid:this.storeId,mid:this.machine.id,aid:this.area.id}})},handleConfirm:function(t){this.storeId=t.value.store_id,this.storeName=t.value.store_name},handleChangeMachine:function(t){this.machine=t,this.getMachineConsumptionPackage()},getMachineConsumptionPackage:function(){var t=this,e=this.machine.id,a=this.storeId;e?Object(g["C"])({store_id:a,mid:e}).then((function(e){if("0"===e.return_code){var a=e.data,n=a.list,i=a.start_time,o=a.end_time,s=a.exchange;t.list=n.map((function(t){return Object(r["a"])(Object(r["a"])({},t),{},{limit:t.rules[0].limit,discount:t.rules[0].discount,checked:!!(t.is_check-0)})})),i-0&&o-0?(t.radio="2",t.startDate=i,t.endDate=o):s&&"1"===s.toString()?t.radio="1":(t.radio="",t.startDate=0,t.endDate=0)}})):this.list=[]},handleDateConfirm:function(t){var e=Date.parse(t)/1e3;this[this.currentDateKey]=e,this.dateShow=!1},handleDateCancel:function(){this.handleDateClose()},handleDateClose:function(){this.dateShow=!1},handleOpenCouponDate:function(t){this.currentDateKey=t;var e=this[t];this.currentDate=e?new Date(1e3*e):new Date,this.dateShow=!0},handleChecked:function(t){var e=t.id,a=t.checked;this.list=this.list.map((function(t){if(e===t.id){var n=!a;return Object(r["a"])(Object(r["a"])({},t),{},{checked:n})}return Object(r["a"])(Object(r["a"])({},t),{},{checked:!1})}))},handleSave:function(){for(var t=this.$createElement,e=this,a=e.machine,n=a.id,i=a.no,r=a.name,o=e.startDate,s=e.endDate,c=e.radio,l=e.storeName,d=e.list,u={},h=d.length,f=0;f<h;++f)if(d[f].checked){u=d[f];break}var m=u,p=m.id,v=m.discount,C=m.limit;if(c)if("2"!==c||o-0&&o-0){var b;p&&(b=t("li",{class:"color-error"},["每满",t("span",{class:"color-error"},[C]),"局；送",t("span",{class:"color-error"},[v]),"局"]));var _={};_="2"===c?{mid:n,combo_id:p,start_time:o,end_time:s,exchange:"0"}:{mid:n,combo_id:p,start_time:0,end_time:0,exchange:"1"},Object(g["fb"])(_).then((function(a){"0"!==a.return_code?e.$Tip.warning(a.msg):e.$Confirm({message:"保存成功",descrition:t("ul",{class:"no-ul"},[t("li",[l,"门店"]),t("li",[r,"-",i]),b]),type:"success",confirmName:"我知道了",mask:!0,confirm:function(){return!0}})}))}else e.$Tip.warning("请填写活动期的时间");else e.$Tip.warning("请选择时效")}}},v=p,C=(a("2a5f"),a("2877")),b=Object(C["a"])(v,n,i,!1,null,null,null);e["default"]=b.exports},f059:function(t,e,a){"use strict";a("b0c0");var n,i,r=a("5530"),o=a("5cc0"),s=a("2f62"),c={name:"MyArea",components:{LinkageSelection:o["a"]},model:{prop:"value",event:"trigger-change"},props:{storeId:String,value:{default:function(){return{}}},title:{type:String,default:"请选择区域"},rightIcon:{type:String,default:"arrow"},columns:Array},data:function(){return{list:[]}},watch:{storeId:{handler:function(t){var e=this;t&&this.COMMON_GETAREA_ACTION({storeId:t}).then((function(t){"0"===t.return_code&&(e.list=t.data,e.$emit("trigger-change",{}))}))},immediate:!0}},methods:Object(r["a"])(Object(r["a"])({},Object(s["b"])(["COMMON_GETAREA_ACTION"])),{},{handleChoseArea:function(t){this.$emit("trigger-change",t.value)}}),render:function(){for(var t,e=arguments[0],a=this.value,n=this.list,i=this.handleChoseArea,r=this.title,s=this.rightIcon,c=0,l=0;l<n.length;++l)if(n[l].id===a.id){t=n[l].name,c=l;break}return e(o["a"],{attrs:{"right-icon":s,title:r,value:t,columns:n,"default-index":c},on:{"trigger-confirm":i}})}},l=c,d=a("2877"),u=Object(d["a"])(l,n,i,!1,null,"1953f11e",null),h=u.exports;e["a"]=h}}]);
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["ConsumptionPackage"],{"24b0":function(t,e,i){},"51b9":function(t,e,i){},a40f:function(t,e,i){},adb4:function(t,e,i){"use strict";var n=i("24b0"),a=i.n(n);a.a},b02d:function(t,e,i){"use strict";var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"hhf-input"},[i("div",{staticClass:"flex-row flex-between-center"},[i("div",{staticClass:"hhf-input-left"},[t._t("start"),i("div",{staticClass:"size-28 color-3 hhf-input-left-title"},[t._v(" "+t._s(t.$slots["title"]?null:t.title)+" "),t._t("title")],2)],2),i("div",{staticClass:"hhf-input-right"},[i("div",{class:["hhf-input-content size-28",t.width?null:"flex-1",t.border?"border":null],style:t.getInputStyle},[t.$slots["content"]?t._t("content"):i("input",{class:["hhf-input-entry",t.inputClass],style:{"text-align":t.position},attrs:{maxlength:t.maxlength,type:t.type,placeholder:t.placeholder},domProps:{value:t.value},on:{input:function(e){return t.$emit("trigger-input",e.target.value)},focus:t.handleFocus,blur:function(e){return t.$emit("trigger-blur",e.target.value)}}})],2),[t.suffix?i("span",{staticClass:"size-28 color-3 padding-left-10"},[t._v(t._s(t.suffix))]):t._e(),t._t("suffix")]],2)]),[void 0!==t.errorText?i("div",{staticClass:"color-error size-20 height-err",style:t.errorStyle},[t._v(" "+t._s(t.errorText)+" ")]):t._e(),t._t("end")]],2)},a=[],s=(i("99af"),i("caad"),i("a9e3"),i("5530")),o=i("53ca"),r={name:"HhfInput",components:{},model:{prop:"value",event:"trigger-input"},props:{value:{default:""},placeholder:String,position:{default:"right",type:String},leftIcon:{default:"",type:String},rightIcon:{default:"",type:String},suffix:{type:String,default:""},title:{default:"",type:String},width:{type:String},border:{type:Boolean,default:!1},inputStyle:{type:String||Object,default:""},errorStyle:{type:String||Object,default:""},errorText:{type:String},inputClass:[String,Array],maxlength:Number,type:{default:"text",type:String,validator:function(t){return["text","number","tel"].includes(t)}}},data:function(){return{}},computed:{getInputStyle:function(){if("string"===typeof this.inputStyle){var t=this.width?"width:".concat(this.width,";"):"";return"".concat(this.inputStyle).concat(t)}return"object"===Object(o["a"])(this.inputStyle)?Object(s["a"])(Object(s["a"])({},this.inputStyle),{},{width:this.width}):{width:this.width}}},mounted:function(){},methods:{handleFocus:function(t){if(/(iPhone|iPad|iPod|iOS|Android)/i.test(navigator.userAgent)&&!/(Win32)/i.test(navigator.platform)){var e=t.target;e.setSelectionRange&&e.setSelectionRange(e.value.length,e.value.length)}}}},l=r,c=(i("adb4"),i("2877")),d=Object(c["a"])(l,n,a,!1,null,null,null),u=d.exports;e["a"]=u},bfce:function(t,e,i){"use strict";var n=i("a40f"),a=i.n(n);a.a},c2ab:function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"consumption-package"},[i("div",{staticClass:"header bgcolor-f"},[i("div",{staticClass:"fixed top-0 left-0 width-2half bgcolor-f",staticStyle:{"z-index":"10"}},[i("MyStore",{attrs:{"store-id":t.storeId,"default-index":0},on:{"trigger-click":t.handleConfirm}},[i("div",{staticClass:"flex-row flex-end-center flex-1"},[i("TipIcon")],1)])],1)]),i("div",{staticClass:"main"},[i("dl",{staticClass:"container margin-0"},[i("van-pull-refresh",{staticStyle:{overflow:"initial"},on:{refresh:t.handleRefresh},model:{value:t.freshLoading,callback:function(e){t.freshLoading=e},expression:"freshLoading"}},[i("van-list",{attrs:{finished:t.finished,"finished-text":"没有更多了",offset:10},on:{load:t.handleLoading},model:{value:t.loading,callback:function(e){t.loading=e},expression:"loading"}},[i("dt",{staticClass:"size-30 title flex-row flex-between-center"},[i("span",[t._v("当前消费套餐")]),i("van-button",{attrs:{type:"info",size:"small"},on:{click:t.handleGoMachine}},[t._v("机台套餐配置")])],1),t._l(t.list,(function(e,n){return i("dd",{key:e.id,staticClass:"content"},[i("ConsumptionPackageItem",{attrs:{packageItem:e},on:{"trigger-delete":function(i){return t.handleDelete(e.id,n)},"trigger-edit":t.handleEdit}})],1)}))],2)],1)],1)]),i("HhfButton",{attrs:{type:"info","bottom-z-index":3,size:"large"},on:{"trigger-click":t.handleAdd}},[t._v("新增消费套餐")]),i("ConsumptionPackagePopup",{attrs:{itemData:t.itemData},on:{"trigger-save":t.handleSave},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}})],1)},a=[],s=(i("99af"),i("d81d"),i("a434"),i("5530")),o=i("de0f"),r=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("van-popup",{attrs:{"close-on-click-overlay":!1},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[i("div",{staticClass:"consumption-package-popup"},[i("dl",{staticClass:"list-first"},[i("dt",{staticClass:"title size-28 weight-bold"},[t._v("套餐名称")]),i("dd",{staticClass:"content"},[i("HhfInput",{attrs:{placeholder:"请输入套餐名称",position:"left"},model:{value:t.packageData.title,callback:function(e){t.$set(t.packageData,"title",e)},expression:"packageData.title"}})],1),i("dd",{staticClass:"content border"})]),i("dl",{staticClass:"list-second"},[i("dt",{staticClass:"title size-28 weight-bold"},[t._v("规则")]),i("dd",{staticClass:"margin-0 content"},[i("HhfInput",{attrs:{title:"每满",type:"tel",placeholder:"1~20",position:"center","error-text":t.limitError,width:"2rem",border:"",suffix:"局"},on:{"trigger-blur":function(e){return t.handleBlur("limitError",t.packageData.limit)}},model:{value:t.packageData.limit,callback:function(e){t.$set(t.packageData,"limit",e)},expression:"packageData.limit"}})],1),i("dd",{staticClass:"margin-0 content"},[i("HhfInput",{attrs:{title:"送　",type:"tel",placeholder:"1~20",position:"center","error-text":t.discountError,width:"2rem",border:"",suffix:"局"},on:{"trigger-blur":function(e){return t.handleBlur("discountError",t.packageData.discount)}},model:{value:t.packageData.discount,callback:function(e){t.$set(t.packageData,"discount",e)},expression:"packageData.discount"}})],1)]),i("div",{staticClass:"cross",on:{click:t.handleClose}},[i("van-icon",{staticClass:"weight-bold",attrs:{name:"cross",color:"#ee0a24",size:"20px"}})],1),i("div",{staticClass:"text-center"},[i("HhfButton",{attrs:{type:"info",size:"normal",radius:"0.1rem"},on:{"trigger-click":t.handleSave}},[t._v("保存")])],1)])])},l=[],c=i("b02d"),d={name:"ConsumptionPackagePopup",components:{HhfInput:c["a"],HhfButton:o["a"]},model:{prop:"show",event:"trigger-change"},props:{show:{type:Boolean,default:!1},itemData:{type:Object}},data:function(){return{limitError:"",discountError:"",packageData:{}}},computed:{},watch:{itemData:function(t){this.limitError="",this.discountError="",t&&(this.packageData={title:t.title,id:t.id,store_id:t.store_id,limit:t.limit,discount:t.discount})}},mounted:function(){},methods:{handleBlur:function(t,e){/^[0-9]*$/.test(e)?this[t]=e-0>=0&&e-0<=20?"":"0~20局数":this[t]="格式不正确"},handleClose:function(){this.$emit("trigger-change",!1)},handleSave:function(){var t=this.packageData,e=t.title,i=t.discount,n=t.limit;if(e)return!/^[0-9]*$/.test(i)||i-0<0||i-0>20?(this.discountError="0~20局数",void this.$Tip.warning("请填入正确的格式")):!/^[0-9]*$/.test(n)||n-0<0||n-0>20?(this.limitError="0~20局数",void this.$Tip.warning("请填入正确的格式")):void this.$emit("trigger-save",this.packageData);this.$Tip.warning("名称不能为空")}}},u=d,h=(i("d379"),i("2877")),f=Object(h["a"])(u,r,l,!1,null,"087e0612",null),p=f.exports,g=i("a8aa"),m=i("c85b"),v=i("5212"),b=i("365c"),w={name:"ConsumptionPackage",components:{MyStore:g["a"],HhfButton:o["a"],ConsumptionPackageItem:v["a"],ConsumptionPackagePopup:p,TipIcon:m["a"]},data:function(){return{storeId:null,show:!1,page:1,limit:20,freshLoading:!1,loading:!1,finished:!0,list:[],itemData:null}},computed:{},created:function(){var t=this.$route.query.sid;t&&(this.storeId=t)},mounted:function(){},methods:{getDataList:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(){};this.$Loading({message:"加载中..."});var i=this.page,n=this.limit,a=this.storeId;Object(b["o"])({store_id:a,limit:n,page:i}).then((function(i){t.$Loading.clear();var n=[];"0"===i.return_code?(n=i.data.list.map((function(t){var e=t.rules[0].limit,i=t.rules[0].discount;return Object(s["a"])(Object(s["a"])({},t),{},{limit:e,discount:i})})),++t.page):t.$Tip.warning(i.msg),e(n)}))},handleRefresh:function(){var t=this;this.page=1,this.getDataList((function(e){t.list=e,t.finished=e.length<t.limit||0===e.length,t.freshLoading=!1}))},handleLoading:function(){var t=this;this.getDataList((function(e){t.list=t.list.concat(e),t.finished=e.length<t.limit||0===e.length,t.loading=!1}))},handleConfirm:function(t){this.storeId=t.value.store_id,this.handleRefresh()},handleRouter:function(){this.$router.push({name:"Article"})},handleDelete:function(t,e){var i=this;this.$Confirm({message:"确定删除？",mask:!0,maskOpacity:1,maskColor:"rgba(0,0,0,0.3)",confirm:function(n){return i.$Loading("正在删除……"),Object(b["h"])({id:t}).then((function(t){if(i.$Loading.clear(),"0"===t.return_code)return i.$Confirm.clear(n),i.$Tip.success(t.msg),void i.list.splice(e,1);i.$Tip.warning(t.msg)})),!0},cancel:function(){}})},handleEdit:function(t){this.itemData=t,this.show=!0},handleAdd:function(){this.itemData={store_id:this.storeId},this.show=!0},handleGoMachine:function(){this.$router.push({name:"MachineConsumptionMeal",query:{sid:this.storeId}})},handleSave:function(t){var e=this,i=t.title,n=t.store_id,a=t.discount,o=t.limit,r=t.id,l={title:i,store_id:n,rules:[{discount:a,limit:o}]};if(this.$Loading("正在保存……"),r)return l.id=r,void Object(b["j"])(l).then((function(t){if(e.$Loading.clear(),"0"===t.return_code)return e.list=e.list.map((function(t){return t.id===r&&(t.title=i,t.discount=a,t.limit=o,t.rules=[{discount:a,limit:o}]),t})),e.$Tip.success(t.msg),void(e.show=!1);e.$Tip.warning(t.msg)}));Object(b["a"])(l).then((function(t){if(e.$Loading.clear(),"0"===t.return_code)return e.list.push(Object(s["a"])(Object(s["a"])({},l),{},{discount:a,limit:o,id:t.data})),e.$Tip.success(t.msg),void(e.show=!1);e.$Tip.warning(t.msg)}))}}},y=w,k=(i("bfce"),Object(h["a"])(y,n,a,!1,null,null,null));e["default"]=k.exports},d379:function(t,e,i){"use strict";var n=i("51b9"),a=i.n(n);a.a}}]);
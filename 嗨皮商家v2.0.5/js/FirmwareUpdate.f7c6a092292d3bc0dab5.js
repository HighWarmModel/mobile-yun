(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["FirmwareUpdate"],{"048b":function(t,e,n){"use strict";var a=n("40ec"),s=n.n(a);s.a},2286:function(t,e,n){"use strict";var a=n("4600"),s=n.n(a);s.a},"2c36":function(t,e,n){"use strict";n.r(e);var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"firmware-update"},[n("div",{staticClass:"header bgcolor-f"},[n("MyStore",{attrs:{"store-id":t.store_id,"default-index":0},on:{"trigger-click":t.handleConfirm}},[n("div",{staticClass:"flex-row flex-end-center flex-1"},[n("van-icon",{attrs:{name:"question-o",size:"0.4rem"},on:{click:t.handleRouter}})],1)])],1),n("div",{staticClass:"main"},[n("div",{staticClass:"container bgcolor-f2"},[n("div",{staticClass:"border"}),n("van-pull-refresh",{staticClass:"fresh",on:{refresh:t.handleRefresh},model:{value:t.isLoading,callback:function(e){t.isLoading=e},expression:"isLoading"}},[n("div",{staticClass:"content size-28 bgcolor-f"},[n("h5",{staticClass:"margin-0 padding-20-30 bgcolor-f size-28 flex-row flex-between-center"},[n("span",[t._v("我的机台")]),t.awaitUpdateColumns.length>0?n("span",{staticClass:"color-info",on:{click:t.putEquipmentUpdate}},[t._v("一键更新")]):t._e()]),n("div",{staticClass:"border"}),t._l(t.columns,(function(e,a){return n("MachineCard",{key:a,attrs:{title:e.area_name+"（"+e.intro+"）"}},[e.items.length>0?t._l(e.items,(function(e){return n("li",{key:e.machine_id},[n("TabulatingCard",{attrs:{img:e.img},scopedSlots:t._u(["2"===e.upgrade_status?{key:"tag",fn:function(){return[t._v("待更新")]},proxy:!0}:null,{key:"title",fn:function(){return[t._v(t._s(e.name)+"--"+t._s(e.no))]},proxy:!0},{key:"content",fn:function(){return[t._v(t._s(e.machine_id))]},proxy:!0}],null,!0)})],1)})):[n("li",{staticClass:"firmware-update-empty"},[t._v("该区域设备均是最新版本")])]],2)}))],2)])],1)]),t.status?n("div",[n("EquipmentUpdateProgress",{attrs:{status:t.status,"pivot-text":t.progressNum,percentage:t.percentage},on:{"fail-canel":t.handleClose,"fail-retry":t.handleRetry,"success-confirm":t.handleClose}})],1):t._e()])},s=[],r=(n("99af"),n("4de4"),n("4160"),n("d81d"),n("159b"),n("3835")),i=(n("96cf"),n("1da1")),o=n("2909"),c=n("a8aa"),l=n("6a97"),u=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"equipment-update-progress"},[n("div",{staticClass:"mask"}),n("div",{staticClass:"flex-row flex-center equipment-update-container"},[n("transition",{attrs:{name:"scale"}},["updating"===t.status&&t.show?n("div",{staticClass:"updating popup bgcolor-f"},[n("h5",{staticClass:"color-3 size-32 text-center title"},[t._v("更新中……")]),n("p",{staticClass:"color-7 size-28 text-center describe"},[t._v(" 预计需要5-10分钟，请耐心等待 ")]),n("div",{staticClass:"progress-container"},[n("van-progress",{attrs:{percentage:t.percentage,"pivot-text":t.pivotText,color:t.progressColor,"pivot-color":t.progressTextBgcolor,"text-color":t.progressTextColor,"show-pivot":t.showPivot}}),t.showPivot?t._e():n("span",{staticClass:"progress-content size-28",style:t.progressStyles},[t._v(t._s(t.pivotText))])],1)]):"fail"===t.status&&t.show?n("div",{staticClass:"fail popup bgcolor-f"},[n("h5",{staticClass:"color-3 size-32 text-center title"},[t._v(" 抱歉，部分设备更新未成功 ")]),n("p",{staticClass:"color-7 size-28 text-center describe"},[t._v(" 请检查网络，重新尝试更新 ")]),n("div",{staticClass:"text-center size-0"},[n("HhfButton",{attrs:{radius:"0.4rem",type:"default",size:"small"},on:{"trigger-click":t.handleFailCancel}},[t._v("暂不更新")]),n("HhfButton",{attrs:{styles:{marginLeft:"0.5rem"},radius:"0.4rem",type:"danger",size:"small"},on:{"trigger-click":t.handleFailRetry}},[t._v("重试")])],1)]):"success"===t.status&&t.show?n("div",{staticClass:"fail popup bgcolor-f"},[n("h5",{staticClass:"color-3 size-32 text-center title"},[t._v("更新完毕")]),n("p",{staticClass:"color-7 size-28 text-center describe"},[t._v(" 您的设备已更新到最新版本! ")]),n("div",{staticClass:"text-center size-0"},[n("HhfButton",{attrs:{radius:"0.4rem",type:"info",size:"small"},on:{"trigger-click":t.handleSuccessConfirm}},[t._v("确认")])],1)]):t._e()])],1)])},d=[],f=(n("caad"),n("a9e3"),n("de0f")),p={name:"EquipmentUpdateProgress",components:{HhfButton:f["a"]},props:{status:{type:String,validator:function(t){return["success","updating","fail"].includes(t)}},percentage:{type:Number,default:0},pivotText:String,showPivot:{type:Boolean,default:!1},progressColor:{type:String,default:"#1989fa"},progressTextColor:{type:String,default:"#ffffff"},progressTextBgcolor:{type:String,default:"#1989fa"}},data:function(){return{show:!1}},computed:{progressStyles:function(){return{backgroundColor:this.progressTextBgcolor,color:this.progressTextColor}}},mounted:function(){var t=this;this.$nextTick((function(){t.show=!0}))},methods:{handleFailCancel:function(){this.$emit("fail-canel")},handleFailRetry:function(){this.$emit("fail-retry")},handleSuccessConfirm:function(){this.$emit("success-confirm")}}},h=p,m=(n("96a3"),n("2877")),g=Object(m["a"])(h,u,d,!1,null,"d02cc796",null),b=g.exports,v=b,C=n("b780"),x=n("b279"),_=n("365c"),y={name:"FirmwareUpdate",components:{MyStore:c["a"],MachineCard:l["a"],TabulatingCard:C["a"],EquipmentUpdateProgress:v},data:function(){return this.timer=null,{activeNames:[0],columns:[],isLoading:!1,store_id:null,status:"",progressNum:"",percentage:0}},computed:{awaitUpdateColumns:function(){var t=[];return this.columns.forEach((function(e){var n=e.items.filter((function(t){return"2"===t.upgrade_status}));t=[].concat(Object(o["a"])(t),Object(o["a"])(n))})),t},awaitMidsParams:function(){return this.awaitUpdateColumns.map((function(t){return{mid:t.machine_id,task_id:t.task_id}}))}},created:function(){var t=this.$route.query.sid;t&&(this.store_id=t)},mounted:function(){},beforeDestroy:function(){clearTimeout(this.timer),this.timer=null},methods:{handleConfirm:function(t){this.store_id=t.value.store_id,this.judgeEquipmentUpdateStatus()},handleClose:function(){this.status=""},handleRetry:function(){this.putEquipmentUpdate()},handleRouter:function(){this.$router.push({name:"Article"})},judgeEquipmentUpdateStatus:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,a,s,i,o;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$toast.loading({message:"加载中...",duration:0}),e.next=3,Object(x["a"])(_["X"],{store_id:t.store_id});case 3:if(n=e.sent,a=Object(r["a"])(n,2),s=a[0],i=a[1],!s){e.next=10;break}return t.$toast.clear(),e.abrupt("return");case 10:return e.next=12,Object(x["a"])(t.getEquipmentUpdateList);case 12:"0"===i.return_code&&(o=i.data,"1"===o&&t.getEquipmentUpdateProgress());case 13:case"end":return e.stop()}}),e)})))()},getEquipmentUpdateProgress:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,a,s,i,o,c,l,u;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return clearTimeout(t.timer),t.timer=null,e.next=4,Object(x["a"])(_["q"],{store_id:t.store_id,mids:t.awaitMidsParams});case 4:if(n=e.sent,a=Object(r["a"])(n,2),s=a[0],i=a[1],t.$toast.clear(),!s){e.next=11;break}return e.abrupt("return",s);case 11:if(!i.data){e.next=28;break}if(o=i.data,c=o.total_num,l=o.succ_num,u=o.fail_num,c!==l){e.next=20;break}return t.getEquipmentUpdateList(),t.status="success",e.abrupt("return");case 20:if(c!==l+u){e.next=24;break}return t.getEquipmentUpdateList(),t.status="fail",e.abrupt("return");case 24:t.status="updating",t.percentage=Math.ceil(l/c*100),t.progressNum="".concat(l," / ").concat(c),setTimeout((function(){t.getEquipmentUpdateProgress()}),1e4);case 28:case"end":return e.stop()}}),e)})))()},putEquipmentUpdate:function(){var t=this;0!==this.awaitUpdateColumns.length?(this.$toast.loading({message:"加载中...",duration:0}),Object(_["bb"])({store_id:this.store_id,mids:this.awaitMidsParams}).then((function(e){"0"!==e.return_code&&e.msg&&t.$Tip.warning(e.msg),t.$toast.clear()})),this.getEquipmentUpdateProgress()):this.$Tip.warning("没有机台可以更新")},getEquipmentUpdateList:function(){var t=this;return Object(i["a"])(regeneratorRuntime.mark((function e(){var n,a,s,i;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.$toast.loading({message:"加载中...",duration:0}),e.next=3,Object(x["a"])(_["p"],{store_id:t.store_id});case 3:if(n=e.sent,a=Object(r["a"])(n,2),s=a[0],i=a[1],t.$toast.clear(),!s){e.next=10;break}return e.abrupt("return");case 10:return"0"===i.return_code?t.columns=i.data:i.msg&&t.$Tip.warning(i.msg),e.abrupt("return",i);case 12:case"end":return e.stop()}}),e)})))()},handleRefresh:function(){var t=this;this.getEquipmentUpdateList().then((function(){t.isLoading=!1}))}}},w=y,O=(n("7d44"),Object(m["a"])(w,a,s,!1,null,null,null));e["default"]=O.exports},3150:function(t,e,n){},3835:function(t,e,n){"use strict";function a(t){if(Array.isArray(t))return t}n.d(e,"a",(function(){return o}));n("a4d3"),n("e01a"),n("d28b"),n("d3b7"),n("3ca3"),n("ddb0");function s(t,e){if("undefined"!==typeof Symbol&&Symbol.iterator in Object(t)){var n=[],a=!0,s=!1,r=void 0;try{for(var i,o=t[Symbol.iterator]();!(a=(i=o.next()).done);a=!0)if(n.push(i.value),e&&n.length===e)break}catch(c){s=!0,r=c}finally{try{a||null==o["return"]||o["return"]()}finally{if(s)throw r}}return n}}var r=n("06c5");function i(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function o(t,e){return a(t)||s(t,e)||Object(r["a"])(t,e)||i()}},"40ec":function(t,e,n){},4600:function(t,e,n){},"48d0":function(t,e,n){"use strict";var a=n("9d6c"),s=n.n(a);s.a},5594:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"bottom-popup"},[n("van-popup",{attrs:{position:"bottom","close-on-click-overlay":t.maskClose,overlay:t.overlay},on:{"click-overlay":t.handleClose},model:{value:t.show,callback:function(e){t.show=e},expression:"show"}},[n("van-picker",{attrs:{"show-toolbar":"",columns:t.columns,"default-index":t.defaultIndex},on:{change:t.handleChange,cancel:t.handleCancel,confirm:t.handleConfirm}})],1)],1)},s=[],r=(n("a9e3"),{name:"BottomPopup",components:{},props:{maskClose:{type:Boolean,default:!1},columns:{default:function(){return[]},type:Array},overlay:{default:!0,type:Boolean},show:{default:!1,type:Boolean},defaultIndex:Number},data:function(){return{loading:!0}},computed:{},watch:{columns:{handler:function(){this.loading=!1}}},mounted:function(){},methods:{handleCancel:function(){this.$emit("trigger-cancel"),this.handleClose()},handleConfirm:function(t,e){this.$emit("trigger-confirm",{value:t,index:e}),this.handleClose()},handleClose:function(){this.$emit("trigger-close")},handleChange:function(){}}}),i=r,o=n("2877"),c=Object(o["a"])(i,a,s,!1,null,"2f72655a",null),l=c.exports;e["a"]=l},"573d":function(t,e,n){"use strict";var a=n("9529"),s=n.n(a);s.a},"6a97":function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("dl",{staticClass:"machine-card"},[t.title?n("dt",{staticClass:"size-28 color-3 machine-card-place"},[t._v(t._s(t.title))]):t._e(),n("dd",{staticClass:"machine-card-main bgcolor-f2"},[n("ul",{staticClass:"machine-card-content"},[t._t("default")],2)])])},s=[],r={name:"MachineCard",components:{},props:{title:String},data:function(){return{}},computed:{},mounted:function(){},methods:{}},i=r,o=(n("2286"),n("2877")),c=Object(o["a"])(i,a,s,!1,null,null,null),l=c.exports;e["a"]=l},"7d44":function(t,e,n){"use strict";var a=n("3150"),s=n.n(a);s.a},9529:function(t,e,n){},"96a3":function(t,e,n){"use strict";var a=n("ed2e"),s=n.n(a);s.a},"9d6c":function(t,e,n){},a8aa:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"my-store"},[n("div",{staticClass:"my-store-container size-32 flex-row flex-start-center"},[n("div",{on:{click:t.handleClick}},[n("span",{staticClass:"my-store-name color-393D49"},[t._v(t._s(t.store.store_name))]),n("van-icon",{staticClass:"color-de",attrs:{name:t.arrow}})],1),t._t("default")],2),n("div",{staticClass:"border"}),n("div",[n("BottomPopup",{attrs:{columns:t.columns,"default-index":t.selectIndex,show:t.show},on:{"trigger-confirm":t.handleConfirm,"trigger-close":t.handleClose}})],1)])},s=[],r=(n("4de4"),n("d81d"),n("a9e3"),n("5530")),i=n("5594"),o=n("2f62"),c={name:"MyStore",components:{BottomPopup:i["a"]},props:{open:{default:!1,type:Boolean},defaultIndex:Number,storeId:[String,Number]},data:function(){return{show:!1,store:{store_name:"请选择门店"},selectIndex:null}},computed:Object(r["a"])(Object(r["a"])({},Object(o["d"])({storeList:function(t){return t.common.storeList}})),{},{columns:{get:function(){var t=this.storeList;return t.map((function(t){var e=Object(r["a"])({text:t.store_name},t);return e}))}},arrow:function(){return this.show?"arrow-up":"arrow-down"}}),watch:{storeList:{handler:function(t){var e=this.storeId,n=this.defaultIndex;if(t.length>0){if(e&&e>=0){var a=t.map((function(t,e){return Object(r["a"])(Object(r["a"])({},t),{},{index:e})})).filter((function(t){return t.store_id===String(e)}));if(a.length>0){var s=a[0];this.selectIndex=s.index,this.store=Object(r["a"])({},s)}}else n>=0&&(this.selectIndex=n,this.store=Object(r["a"])({},t[0]));(n>=0||e>=0)&&this.$emit("trigger-click",{value:Object(r["a"])(Object(r["a"])({},this.store),{},{index:this.selectIndex})})}},immediate:!0}},created:function(){0===this.storeList.length&&this.getStore()},methods:Object(r["a"])(Object(r["a"])({},Object(o["b"])(["COMMON_GETSTORE_ACTION"])),{},{handleClick:function(){this.show=!0},handleConfirm:function(t){var e=t.value,n=t.index;this.store=Object(r["a"])({},e),this.$emit("trigger-click",{value:e,index:n})},handleClose:function(){this.show=!1},getStore:function(){var t=this;this.COMMON_GETSTORE_ACTION().then((function(e){"0"!==e.return_code&&t.$Tip.warning(e.msg)}))}})},l=c,u=(n("48d0"),n("2877")),d=Object(u["a"])(l,a,s,!1,null,"de8e6c12",null),f=d.exports;e["a"]=f},b4ee:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("span",{class:t.wrapClasses,style:t.styles,on:{click:t.handleClick}})},s=[],r=(n("99af"),n("b0c0"),n("d3b7"),n("ac1f"),n("25f0"),n("1276"),n("2909")),i={name:"HhfIcon",components:{},props:{classes:[Array,String],styles:Object,name:{type:String,required:!0}},data:function(){return{}},computed:{wrapClasses:function(){var t=["hhf-icon","hhf-iconfont","hhf-icon-".concat(this.name)];if("[object Array]"===Object.prototype.toString.call(this.classes))t=[].concat(Object(r["a"])(t),Object(r["a"])(this.classes));else if("string"===typeof this.classes){var e=this.classes.split(" ");t=[].concat(Object(r["a"])(t),Object(r["a"])(e))}return t}},mounted:function(){},methods:{handleClick:function(){this.$emit("trigger-click")}}},o=i,c=n("2877"),l=Object(c["a"])(o,a,s,!1,null,"0e833f38",null),u=l.exports;e["a"]=u},b780:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"tabulating-card"},[n("div",{staticClass:"tabulating-card-img bgcolor-f2 flex-row flex-center"},[t.$slots.tag?n("div",{staticClass:"tabulating-card-tag size-24"},[n("van-tag",{attrs:{color:t.tagColor,size:"large"}},[t._t("tag")],2)],1):t._e(),n("img",{staticClass:"tabulating-card-img-content",attrs:{src:t.img,alt:""}})]),n("div",[n("p",{staticClass:"flex-row flex-between-center"},[t._t("title")],2),n("p",{staticClass:"flex-row flex-between-center"},[t._t("content")],2)])])},s=[],r={name:"TabulatingCard",components:{},props:{img:String,tagColor:{type:String,default:"#ff5722"}},data:function(){return{}},computed:{},mounted:function(){},methods:{}},i=r,o=(n("573d"),n("2877")),c=Object(o["a"])(i,a,s,!1,null,null,null),l=c.exports;e["a"]=l},de0f:function(t,e,n){"use strict";var a=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{class:["size-0",t.getBottomZIndexCls]},[n("div",{class:t.wrapClasses,style:t.wrapStyles,on:{click:t.handleClick}},[n("div",{staticClass:"hhf-button-container flex-row flex-center"},[!t.$slots.loading&&t.loading?[n("div",{staticClass:"hhf-button-loading-container"},[n("div",{staticClass:"hhf-button-loading-content"},[n("HhfIcon",{attrs:{name:"spinner-loading"}})],1)])]:t.loading?[t._t("loading")]:t._e(),t._t("default")],2)])])},s=[],r=(n("99af"),n("caad"),n("a9e3"),n("d3b7"),n("ac1f"),n("25f0"),n("1276"),n("5530")),i=n("b4ee"),o={name:"",components:{HhfIcon:i["a"]},props:{disabled:{type:Boolean,default:!1},loading:{type:Boolean,default:!1},loadingText:{type:String,default:"加载中…"},text:{type:String,default:"确定"},bottomZIndex:{type:Number},radius:String,activeColor:Object,plain:Boolean,type:{type:String,default:"default",validator:function(t){return["default","primary","success","info","warning","danger"].includes(t)}},size:{type:String,default:"normal",validator:function(t){return["normal","large","small","mini","custom"].includes(t)}},classes:[String,Array],styles:Object},data:function(){return{}},computed:{getBottomZIndexCls:function(){return this.bottomZIndex?"hhf-button-".concat(this.size,"-height"):null},wrapClasses:function(){var t=this.classes,e=this.size,n=this.type,a=this.plain,s=this.loading,r=this.disabled,i=this.bottomZIndex,o=["hhf-button","hhf-button-".concat(n),"hhf-button-".concat(e),i?"hhf-button-".concat(e,"-fixed"):null];if("[object Array]"===Object.prototype.toString.call(t))o=o.concat(t);else if("string"===typeof t){var c=t.split(" ");o=o.concat(c)}return a&&o.push("hhf-button-plain"),s&&o.push("hhf-button-loading"),r&&o.push("hhf-button-disabled"),o},wrapStyles:function(){var t=this.styles,e=this.radius,n=this.bottomZIndex,a=Object(r["a"])(Object(r["a"])({},t),{},{borderRadius:e,zIndex:n});return a}},mounted:function(){},methods:{handleClick:function(){var t=this.loading,e=this.disabled;t||e||this.$emit("trigger-click")}}},c=o,l=(n("048b"),n("2877")),u=Object(l["a"])(c,a,s,!1,null,null,null),d=u.exports;e["a"]=d},ed2e:function(t,e,n){}}]);